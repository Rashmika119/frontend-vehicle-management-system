<div class="container py-3">

  @if (!clientName) {
    <div class="alert alert-danger" role="alert">
      You must login first to import/export vehicles. Please sign in.
    </div>
  }

  <div class="card p-3 mb-4" [class.disabled-section]="!clientName">
    <h5>Import Vehicles CSV</h5>

    <div class="input-group mb-3">
      <input type="file"
             class="form-control"
             accept=".csv"
             (change)="handleFileInput($event)"
             [disabled]="!clientName"
             #fileInput>
      <button class="btn btn-primary"
              (click)="importCsv()"
              [disabled]="!selectedFile || !clientName">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="me-1" viewBox="0 0 16 16">
          <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"/>
          <path d="M7.646 1.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 2.707V11.5a.5.5 0 0 1-1 0V2.707L5.354 4.854a.5.5 0 1 1-.708-.708l3-3z"/>
        </svg>
        Import CSV
      </button>
    </div>
    
    @if (selectedFile) {
      <small class="text-muted">
        <strong>Selected:</strong> {{ selectedFile.name }} ({{ (selectedFile.size / 1024).toFixed(2) }} KB)
      </small>
    }
  </div>
  <div class="card p-3 mb-4" [class.disabled-section]="!clientName">
    <h5>Export Vehicles CSV</h5>

    <div class="input-group mb-3">
      <span class="input-group-text">Vehicle Age (years)</span>
      <input type="number"
             class="form-control"
             [(ngModel)]="ageOfVehicle"
             placeholder="Enter minimum age"
             min="0"
             [disabled]="!clientName">
      <button class="btn btn-success"
              (click)="exportCsv()"
              [disabled]="!ageOfVehicle || !clientName">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="me-1" viewBox="0 0 16 16">
          <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"/>
          <path d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z"/>
        </svg>
        Export CSV
      </button>
    </div>
  </div>

  @if (notificationMessage && !showDownloadPopup) {
    <div class="alert alert-info mt-3">
      <strong>Status:</strong> {{ notificationMessage }}
    </div>
  }

  @if (showDownloadPopup) {
    <div class="modal-backdrop" (click)="closePopup()">
      <div class="modal-box" (click)="$event.stopPropagation()">
        <div class="text-center">
          <div class="success-icon mb-3">
            <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" fill="currentColor" class="text-success" viewBox="0 0 16 16">
              <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"/>
            </svg>
          </div>

          <h5 class="mb-2">Export Completed!</h5>
          <p class="text-muted mb-3">Your file is ready to download.</p>
          
          <div class="countdown-container mb-4">
            <div class="countdown-circle">
              <span class="countdown-number">{{ countdown }}</span>
            </div>
            <small class="text-muted d-block mt-2">Closing in {{ countdown }}s</small>
          </div>

          <div class="d-flex gap-2 justify-content-center">
            <button class="btn btn-primary" (click)="downloadCsv()">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="me-1" viewBox="0 0 16 16">
                <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"/>
                <path d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z"/>
              </svg>
              Download
            </button>
            <button class="btn btn-secondary" (click)="closePopup()">Close</button>
          </div>
        </div>
      </div>
    </div>
  }

</div>